apiVersion: "apps/v1"
kind: "Deployment"
metadata:
  name: "smeiling-{{ service.name }}-deployment"
  labels:
    app: "smeiling-{{ service.name }}"
    tier: "application"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: "smeiling-{{ service.name }}"
      tier: "application"
  template:
    metadata:
      labels:
        app: "smeiling-{{ service.name }}"
        tier: "application"

    spec:
      containers:
      - name: "splunk"
        image: "{{ service.container_repo }}/splunk"
        ports:
          - name: "splunk-port"
            containerPort: 5000
          
      - name: "nginx"
        image: "{{ service.container_repo }}/nginx"
        ports:
          - name: "nginx-http"
            containerPort: 80
          - name: "nginx-https"
            containerPort: 443

      - name: "smeiling"
        image: "smeiling"
        ports:
          - name: "{{ service.container_repo }}/smeiling-port"
            containerPort: 8000
